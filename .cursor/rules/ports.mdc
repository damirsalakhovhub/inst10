---
alwaysApply: true
---

# Port Configuration Rules

## Default Ports by Framework

- **Ruby on Rails projects**: Always use port **5000** (not 3000)
  - Example: `PORT=5000 bin/rails server`
  - When using foreman/Procfile.dev, ensure web process uses PORT=5000

- **React projects**: Use port **3000** (default)
  - Example: `npm start` or `yarn start` (defaults to 3000)

## Rationale

Port 5000 for Rails avoids conflicts with React development servers which commonly use 3000.

---

# Development Mode Setup

## Rails Development Server Setup

**Single command to run everything:**

```bash
bin/dev
```

This starts both Rails server (port 5000) and Sass compiler via `Procfile.dev`.

## Procfile.dev Configuration

Ensure `Procfile.dev` contains:
```
web: PORT=5000 bin/rails server
css: bundle exec sass --watch --poll --load-path=app --load-path=ui_kit --load-path=app/views --no-source-map app/assets/stylesheets/application.scss:app/assets/builds/application.css
```

## Cache Clearing (if needed)

If styles or assets get stuck:
```bash
bin/rails tmp:cache:clear
bin/rails assets:clobber
```

## Key Configuration for Live Reloading

- `config/environments/development.rb` - hotwire_livereload watches `app/assets/builds`, cache disabled
- `config/initializers/assets.rb` - load-path for app, ui_kit, app/views
- `config/application.rb` - autoload_paths for ui_kit/components (no eager_load in dev)
- Component preloading should be **disabled** in development to allow hot reloading

## Workflow

1. Run `bin/dev`
2. Change SCSS/Ruby code → auto-recompile → browser auto-refreshes (Hotwire LiveReload)
3. No manual rebuild needed

---

# Troubleshooting

## After bundle install

Always run `rbenv rehash` to update shims for new executables:
```bash
bundle install
rbenv rehash
```

## Server not responding or 403/500 errors

1. Check if server is actually running:
   ```bash
   curl -I http://localhost:5000/
   ```
   - Expected: `HTTP/1.1 200 OK` or redirect to login
   - If `403` from AirTunes or other service: port conflict, kill and restart
   - If connection refused: server not started

2. Check logs in terminal where `bin/dev` is running
3. Common fixes:
   - `bundle install && rbenv rehash`
   - `bin/rails tmp:cache:clear`
   - Kill all processes and restart: `pkill -f "foreman|rails server|sass"; bin/dev`

## Expected behavior

- Landing page (`/`) should return **200 OK** for unauthenticated users (shows login/signup forms)
- If you get a working HTML page (even with auth redirect), server is OK
- Never claim "403 is normal" or "server works but page doesn't load" — always verify server returns proper response
