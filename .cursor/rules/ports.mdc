---
alwaysApply: true
---

# Port Configuration Rules

## Default Ports by Framework

- **Ruby on Rails projects**: Use port **7000** (or 5000 if 7000 unavailable)
  - Example: `PORT=7000 bin/rails server`
  - When using foreman/Procfile.dev, ensure web process uses PORT=7000
  - Note: Port 6000 is blocked by Chrome as unsafe

- **React projects**: Use port **3000** (default)
  - Example: `npm start` or `yarn start` (defaults to 3000)

## Rationale

Port 5000 for Rails avoids conflicts with React development servers which commonly use 3000.

---

# Development Mode Setup

## Rails Development Server Setup

**Single command to run everything:**

```bash
bin/dev
```

This starts Rails server (port 7000). No Sass watcher — CSS is plain files.

## Procfile.dev Configuration

Ensure `Procfile.dev` contains:
```
web: PORT=7000 bin/rails server
```

## Cache Clearing (if needed)

If styles or assets get stuck:
```bash
bin/rails tmp:cache:clear
rm -rf public/assets  # Never use assets:precompile in dev!
```

**NEVER run `bin/rails assets:precompile` in development** — it creates `public/assets/` which Rails serves instead of live-compiled CSS from `app/assets/builds/`, breaking hot reload.

## Key Configuration for Live Reloading

- `config/environments/development.rb` - hotwire_livereload watches `app/assets/stylesheets`, cache disabled
- `config/initializers/assets.rb` - CSS served directly by Propshaft (no Sass)

## Workflow

1. Run `bin/dev`
2. Change CSS/Ruby → browser auto-refreshes (Hotwire LiveReload)
3. No manual rebuild needed

---

# Troubleshooting

## After bundle install

Always run `rbenv rehash` to update shims for new executables:
```bash
bundle install
rbenv rehash
```

## Server Verification (CRITICAL)

**ALWAYS verify server works in a browser, NOT via curl.**

1. **Open browser and navigate to** `http://localhost:7000/`
   - Expected: Landing page loads with login/signup forms
   - If page doesn't load or shows errors: server is NOT working
   - **curl responses are irrelevant** — only browser verification counts

2. **If browser shows errors:**
   - Check logs in terminal where `bin/dev` is running
   - Check for port conflicts: `lsof -ti:7000`
   - Kill conflicting processes: `pkill -f "foreman|rails server|puma|sass"`
   - Restart: `bundle install && rbenv rehash && bin/dev`

3. **Common fixes:**
   - `bundle install && rbenv rehash`
   - `bin/rails tmp:cache:clear`
   - `rm -rf public/assets` (if assets:precompile was run in dev)
   - Kill all processes and restart: `pkill -f "foreman|rails server|puma|sass"; bin/dev`

## Expected behavior

- Landing page (`/`) should **load in browser** for unauthenticated users (shows login/signup forms)
- If browser shows error page or doesn't load: server is NOT working
- **Never claim "server works" based on curl** — always verify in browser
- **Never claim "403 is normal" or "server works but page doesn't load"** — if page doesn't load in browser, fix it
