.btn {
  --btn--height: var(--element-medium--height);
  --btn--icon-size: var(--element-medium--icon-size);
  --btn--padding-inline: var(--element--padding-inline);
  --btn--optical-compensation: 0.125em;

  position: relative;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--element--gap);
  
  padding-inline: var(--btn--padding-inline);
  
  height: var(--element-medium--height);
  font-size: var(--element-medium--font-size);
  line-height: 1;
  font-weight: 500;
  
  background-color: var(--element--color-bg);
  border-radius: var(--element--radius);
  
  transition: background-color 0.1s linear, transform 0.1s linear;

  /* States ------------------------------------------------------------ */
  &:hover:not(:disabled) {
    background-color: var(--element--color-bg-hover);
  }

  &:active:not(:disabled) {
    background-color: var(--element--color-bg-active);
    transform: scale(0.98);
  }

  &:focus-visible {
    outline-width: 2px;
    outline-offset: 0px;
    transition: outline 0.075s linear;
  }

  &:disabled {
    background-color: var(--disabled-color-bg);
    color: var(--disabled-color-font);
    cursor: not-allowed;
  }
}

.btn-loading {
  pointer-events: none;
}

/* Icons ------------------------------------------------------------ */

/* Единое правило для всех SVG внутри кнопок */
.btn svg,
.btn-icon-svg {
  width: 100%;
  height: 100%;
  display: block;
  stroke: currentColor;
  fill: none;
  stroke-width: 2;
}

.btn-icon-left, 
.btn-icon-right {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: var(--btn--icon-size);
  height: var(--btn--icon-size);
  flex-shrink: 0;
}

.btn-icon-left {
  position: relative;
  order: -1;
}

/* Перекрытие спиннера и обычной иконки */
.btn-spinner, 
.btn-icon-normal {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: opacity 0.2s linear, transform 0.2s linear;
}

.btn-spinner {
  opacity: 0;
  transform: scale(0);
}

.btn-spinner svg {
  animation: btn-spin 1s linear infinite;
}

.btn-loading .btn-spinner {
  opacity: 1;
  transform: scale(1);
}

.btn-loading .btn-icon-normal {
  opacity: 0;
  transform: scale(0);
}

/* Плавное появление спиннера в кнопке без иконки */
.btn:not(:has(.btn-icon-normal)) .btn-icon-left {
  width: 0;
  opacity: 0;
  transform: scale(0);
  margin-inline-end: calc(var(--element--gap) * -1);
  transition: width 0.2s linear, opacity 0.2s linear, transform 0.2s linear, margin 0.2s linear;
}

.btn-loading:not(:has(.btn-icon-normal)) .btn-icon-left {
  width: var(--btn--icon-size);
  opacity: 1;
  transform: scale(1);
  margin-inline-end: 0;
}

@keyframes btn-spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

/* Icon-only Button (square) */
.btn-icon-only {
  width: var(--btn--height);
  min-width: var(--btn--height);
  padding: 0;
  justify-content: center;
  gap: 0;
}

/* Optical Compensation */
/* Срабатывает только если есть ВИДИМАЯ иконка (нормальная или активный лоадер) */
.btn:not(.btn-icon-only):has(.btn-icon-normal) {
  &.btn:has(.btn-icon-left) {
    padding-inline-end: calc(var(--btn--padding-inline) + var(--btn--optical-compensation));
  }
  &.btn:has(.btn-icon-right) {
    padding-inline-start: calc(var(--btn--padding-inline) + var(--btn--optical-compensation));
  }
}

/* Sizes ------------------------------------------------------------ */

.btn-tiny {
  height: var(--element-tiny--height);
  font-size: var(--element-tiny--font-size);
  --btn--icon-size: var(--element-tiny--icon-size);
}

.btn-tiny.btn-icon-only {
  width: var(--element-tiny--height);
  min-width: var(--element-tiny--height);
}

.btn-small {
  height: var(--element-small--height);
  font-size: var(--element-small--font-size);
  --btn--icon-size: var(--element-small--icon-size);
}

.btn-small.btn-icon-only {
  width: var(--element-small--height);
  min-width: var(--element-small--height);
}

.btn-large {
  height: var(--element-large--height);
  font-size: var(--element-large--font-size);
  --btn--icon-size: var(--element-large--icon-size);
}

.btn-large.btn-icon-only {
  width: var(--element-large--height);
  min-width: var(--element-large--height);
}

/* Variants ------------------------------------------------------------ */

.btn-primary {
  background-color: var(--color-bg-primary);
  color: var(--white);
  &:hover:not(:disabled) { background-color: var(--color-bg-primary-hover); }
  &:active:not(:disabled) { background-color: var(--color-bg-primary-active); }
}

.btn-contrast {
  background-color: var(--color-bg-invert);
  color: var(--color-font-invert);
  &:hover:not(:disabled) { background-color: var(--color-bg-invert-hover); }
  &:active:not(:disabled) { background-color: var(--color-bg-invert-active); }
}

.btn-rounded {
  border-radius: var(--radius-full);
}

.btn-full-width {
  display: flex;
  width: 100%;
}
